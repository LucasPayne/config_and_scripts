#!/bin/bash
# vidbg: cycle video backgrounds

# mode=cycle
mode=dmenu

vids="$(fd -tf -d1 . ~/drive/videos/vidbg)"

# Cycle through videos
if [ "$mode" = "cycle" ]
then
    num_vids="$(echo "$vids" | wc -l)"
    if [ ! -f /tmp/vidbgnumber ]
    then
        echo 0 > /tmp/vidbgnumber
    else
        n="$(cat /tmp/vidbgnumber)"
        n="$(( ( n + 1 ) % num_vids ))"
        echo "$n" > /tmp/vidbgnumber
    fi
    vid="$(echo "$vids" | sel $((n+1)))"
elif [ "$mode" = "dmenu" ]
then
    vid="$(echo "$vids" | xi basename {} | dmenu)"
    if [ -z "$vid" ]
    then
        exit
    fi
    vid=~/drive/videos/vidbg/"$vid"
else 
    exit 1
fi


#todo: Don't kill all mpvs
pkill '^mpv$'
pkill '^mpvbg$'

pid="$(d mpvbg --mute=yes --video-zoom=0.15 "$vid")"
